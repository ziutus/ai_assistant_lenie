# Epic 9 Retrospective — Project Vision & Documentation Update

**Date:** 2026-02-16
**Facilitator:** Bob (Scrum Master)
**Participants:** Ziutus (Project Lead), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)
**Agent Model:** Claude Opus 4.6
**Sprint:** 2 — Cleanup & Vision Documentation (final epic)

## Epic Summary

| Story | Title | Status |
|-------|-------|--------|
| 9-1 | Update README.md with Project Vision & Roadmap | Done |
| 9-2 | Update Documentation to Reflect Post-Cleanup State | Done |

**Total:** 2 stories — 100% completion

## Delivery Metrics

- Stories completed: 2/2 (100%)
- Story type: Documentation-only (zero application code changes)
- Files modified: 8 (README.md, infra/aws/CLAUDE.md, infra/aws/cloudformation/CLAUDE.md, infra/aws/README.md, infra/aws/serverless/CLAUDE.md, backend/library/CLAUDE.md, docs/architecture-infra.md, docs/project-overview.md)
- Files added: 0
- Files deleted: 0
- Production incidents: 0
- Code review rounds: Story 9-1 (1 round), Story 9-2 (2 rounds)
- Issues found in review: 10 total (9-1: 3 issues; 9-2: 7+3 issues across 2 independent reviews)
- All review issues resolved

## Sprint 2 Overall Summary

Sprint 2 covered Epics 7-9:

| Epic | Title | Stories | Status |
|------|-------|---------|--------|
| 7 | Step Function Update & API Gateway Simplification | 2 | Done |
| 8 | DynamoDB Cache Table Removal | 1 | Done |
| 9 | Project Vision & Documentation Update | 2 | Done |

**Sprint 2 Total:** 3 epics, 5 stories — 100% completion, 0 production incidents.

## What Went Well

### 1. Clear Project Vision in README
README.md now communicates the target vision (Lenie-AI as MCP server for Claude Desktop + Obsidian vault workflow) with a 4-phase roadmap. A new developer can understand the project's direction from this single file.

### 2. Pre-Analysis in Dev Notes
Story 9-2 dev notes included a thorough pre-analysis identifying exactly which files needed changes and what type of changes. This eliminated guesswork and made implementation efficient.

### 3. Multi-Round Code Review
Story 9-2 benefited from 2 independent review rounds that caught 10 total issues — including HIGH-priority stale counts and pytube → pytubefix package rename across 4 files.

### 4. Expanded Verification Patterns
Story 9-2 discovered that grep-based verification is necessary but not sufficient. The team expanded the approach to include semantic review of numeric counts, package names, and terminology consistency.

### 5. Sprint 1 Lessons Applied
Key lessons from Sprint 1 were successfully applied:
- Minimal change approach (targeted edits only)
- Verify against actual state (not assumptions)
- Codebase-wide search for stale references (and expanded to cover more patterns)
- Code review feedback loops

## Challenges and Learnings

### 1. Grep Verification Semantically Limited
Explicit grep patterns (`lenie_cache_*`, `url_add2`, `dynamodb-cache`, `ses.yaml`) catch direct references but miss:
- Stale numeric counts (endpoint count "13" after removal, Lambda count "12" after change, template count "27")
- Package name changes (pytube → pytubefix)
- Terminology inconsistencies ("cache" vs "metadata buffer")

**Lesson:** Documentation verification needs both automated (grep) and semantic review.

### 2. Documentation Stories Are Deceptively Complex
Both stories were "documentation-only" but required multiple review rounds. Story 9-2 had 10 issues discovered across 2 reviews — comparable to code stories.

**Lesson:** Treat documentation stories with the same review rigor as code stories.

### 3. Sprint 1 Retro Action Items Not Followed Through
2 of 3 action items from Sprint 1 retrospective were not addressed:
- Lambda Layer security audit (~1.5+ year old dependencies) — NOT started
- Lambda CF management, CORS hardening — NOT started

Only 1 of 3 was completed: "Plan next sprint" → Sprint 2 was planned and executed.

**Lesson:** Retro commitments must be formally tracked, not just documented.

### 4. Gap Between Tactical Backlog and Strategic Vision
Sprint 3 backlog contains tactical items (tagging, typo fixes, SSM pattern changes) but the strategic vision (Phase 2: MCP Server Foundation) is not reflected in any formal plan. This gap needs a deliberate decision.

## Previous Retro Follow-Through

**Source:** epic-1-6-retro-2026-02-15.md (Sprint 1 combined retrospective)

| # | Action Item | Status | Impact |
|---|------------|--------|--------|
| 1 | Plan next sprint with new epics | ✅ Completed | Sprint 2 planned and executed with full BMad cycle |
| 2 | Lambda Layer security audit (~1.5yr deps) | ❌ Not addressed | Risk continues to accumulate |
| 3 | Consider Lambda CF management, CORS hardening | ❌ Not addressed | Deferred again |

**Lessons Applied:**
- ✅ Code review feedback loops → Applied and improved (multi-round review)
- ✅ Live infrastructure differs from documentation → Verified against actual state
- ✅ Minimal change approach → Only targeted edits
- ✅ Codebase-wide search → Applied AND expanded (semantic review added)

## Technical Debt

| # | Item | Source | Priority | Notes |
|---|------|--------|----------|-------|
| 1 | Lambda Layer dependencies ~1.5+ years old | Sprint 1 retro | High | Security audit needed — BUT only after code cleanup (clean first, secure second) |
| 2 | Lambda name typo `infra-allow-ip-in-secrutity-group` | Sprint 1 retro | Medium | Requires AWS-side Lambda rename first |
| 3 | CORS wildcard `Access-Control-Allow-Origin: '*'` | Sprint 1 retro | Medium | Security concern — address after code cleanup |
| 4 | `lenie-s3-tmp` old bucket not deleted | Sprint 1 retro | Low | Data migrated, bucket still exists |
| 5 | Frontend manual browser verification not done | Sprint 1 retro | Low | Requires manual testing |
| 6 | Lambda functions in API GW managed by hardcoded ARN | Sprint 1 retro | Low | Future: manage as CF resources |

## Key Takeaways

1. **Clean first, secure second, build new third** — Ziutus's priority principle. Remove unnecessary code/functionality before investing in security updates or new features. No point auditing dependencies in code that will be removed.
2. **Documentation stories require multi-round review** — "docs only" does not mean "easy". Story 9-2 had 10 issues across 2 review rounds.
3. **Grep verification is necessary but not sufficient** — Expand to include semantic review: numeric counts, package names, terminology consistency.
4. **Retro commitments must be formally tracked** — 2/3 Sprint 1 action items went unaddressed. Need active tracking mechanism.
5. **Pre-analysis in Dev Notes accelerates implementation** — Story 9-2's pre-analysis identified exact files and changes needed before any edits began.

## Action Items

### Process Improvements

| # | Action | Owner | Deadline | Success Criteria |
|---|--------|-------|----------|-----------------|
| 1 | Introduce 2-round code review for documentation stories | Bob (SM) | Before Sprint 3 | Story template includes "Review Checklist" with grep + semantic review |
| 2 | Expand grep verification checklist with semantic patterns | Dana (QA) | Before Sprint 3 | Checklist covers: name patterns + numeric counts + package names + terminology |
| 3 | Track retro commitments in sprint-status.yaml | Bob (SM) | At Sprint 3 planning | Dedicated section in sprint-status.yaml for retro action items |

### Priority Principle (Ziutus Decision)

**Clean first → Secure second → Build new third**

1. **PRIORITY 1: Code cleanup** — Remove unnecessary functionality, dead code, unused endpoints
2. **PRIORITY 2: Security updates** — Lambda Layer audit, CORS fix, etc. — only on code that survives cleanup
3. **PRIORITY 3: Strategic direction** — MCP Server Foundation (Phase 2) — when code is clean and secure

### Identified Unnecessary Functionality (Ziutus, confirmed during retro)

Three endpoints confirmed for removal:

**1. `/ai_ask` — Remove entirely**
- Flask: `backend/server.py` (lines 539-594)
- Lambda: `app-server-internet/lambda_function.py` (lines 181-234)
- API Gateway: `api-gw-app.yaml` (lines 563-613)
- Frontend: `useManageLLM.js:456` → `handleCorrectUsingAI()`
- Core module: `library.ai.ai_ask()`
- Dependencies: OpenAI, Bedrock, Vertex AI, CloudFerro Bielik

**2. `/translate` — Remove entirely (backend module already missing)**
- Flask: NOT implemented (Lambda-only)
- Lambda: `app-server-internet/lambda_function.py` (lines 71-98)
- API Gateway: `api-gw-app.yaml` (lines 614-664)
- Frontend: `useManageLLM.js:375` → `handleTranslate()`
- Backend module `library.translate` does NOT exist — endpoint is already broken

**3. `/infra/ip-allow` — Remove entirely (not used for RDP access)**
- Lambda: `infra-allow-ip-in-secrutity-group` (archived code, function still exists in AWS)
- API Gateway: `api-gw-app.yaml` (lines 1022-1072)
- Frontend: Not referenced
- Note: Lambda has name typo (`secrutity` → `security`), hardcoded SG ID

### Strategic Planning

| # | Action | Owner | Deadline |
|---|--------|-------|----------|
| 1 | Decide Sprint 3 direction: code cleanup sprint vs MCP Server start | Ziutus + Alice (PO) | Before Sprint 3 planning |
| 2 | Identify unnecessary code/functionality for removal | Charlie (Senior Dev) | During Sprint 3 planning |

### Team Agreements

- Documentation stories receive the same review rigor as code stories
- Retro action items are formally tracked, not just documented
- When grep verification is insufficient, add semantic review step
- Priority principle: clean → secure → build new

## Next Steps

1. **Decide Sprint 3 scope** — code cleanup sprint following "clean first" principle
2. **Identify dead code and unnecessary functionality** for removal candidates
3. **Track these action items** actively during Sprint 3
4. **After cleanup**: address security debt (Lambda Layers, CORS, etc.)
5. **After security**: plan MCP Server Foundation (Phase 2)

## Sprint Assessment

**Epic 9:** Successful completion — 2/2 stories, 100%, zero incidents. Project vision and roadmap now clearly documented.

**Sprint 2 Overall:** Successful — 3 epics, 5 stories, 100% completion. AWS cleanup complete (DynamoDB cache tables removed, API Gateway simplified, Step Function updated). Documentation reflects current state. Project ready for next phase.

**Combined Sprint 1+2:** 9 epics, 15 stories, 100% completion rate across both sprints. IaC coverage achieved, legacy resources cleaned, documentation updated with vision. Strong foundation for future work.
