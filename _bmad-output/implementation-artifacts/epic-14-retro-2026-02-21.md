# Retrospective — Epic 14: Infrastructure Cost & Naming Cleanup

> Date: 2026-02-21 | Reviewer: Claude Opus 4.6 | Format: Condensed (combined Sprint 4 retro)

## Epic Summary

- **Epic:** 14 — Infrastructure Cost & Naming Cleanup
- **Stories:** 2/2 done (14-1, 14-2)
- **Backlog items closed:** B-4 (remove Elastic IP), B-5 (fix Lambda naming)
- **FRs covered:** FR1-FR11 | **NFRs:** NFR2-NFR4, NFR6, NFR7

## Delivery Metrics

- Completion: 100% (2/2 stories)
- Code review findings: 7 (2 HIGH, 2 MEDIUM, 3 LOW)
- Technical debt created: 2 new backlog items (B-21: split shared role, B-22: max retry)
- Production incidents: 0
- Cost savings: ~$3.65/month (EIP removal)

## What Went Well

1. **Critical discovery in 14-2** — Pre-check revealed `api-gw-infra.yaml` already manages `lenie-dev-rds-start` Lambda. Instead of creating a naming conflict, the team decommissioned the redundant `lambda-rds-start.yaml` template entirely. Smart pivot.
2. **Clean resource removal in 14-1** — EIP, EIPAssociation, and PublicIP output removed with zero errors. Verified dynamic IP + Route53 DNS update path works correctly.
3. **Code review found missing IAM permissions** — `api-gw-infra.yaml` shared role was missing EC2 and SQS permissions. These were added during review, preventing future runtime failures.
4. **Pragmatic scope expansion** — Dead `/infra/git-webhooks` endpoint removed opportunistically in 14-2 (Lambda didn't exist, was blocking stack updates). Right call.

## What Could Be Better

1. **14-2 scope creep was significant** — Original AC was "rename FunctionName". Actual work: decommission template + add 3 IAM permission blocks + remove dead endpoint + update 6 docs. Story should have been re-scoped when conflict was discovered.
2. **Shared IAM role is a growing problem** — `LambdaExecutionRole` in `api-gw-infra.yaml` serves 7 Lambda functions with different permission needs. Code review keeps finding gaps. B-21 (split roles) is becoming more urgent.
3. **Documentation updates still span many files** — 14-1 and 14-2 both required updating CLAUDE.md and README.md references. This pattern continues until docs fully reference single source of truth.

## Key Learnings

- **Always pre-check naming before rename** — `grep -r "function-name"` across codebase before modifying any resource
- **Shared IAM roles accumulate permission gaps** — each new integration reveals missing permissions
- **Removal stories need doc-sweep** — every resource removal requires searching all documentation for stale references
- **Dead endpoints block stack updates** — even unused resources cause CloudFormation failures if their dependencies are gone

## Previous Retro Follow-Through (Epic 12)

- ✅ Code review mandatory → Applied, caught 2 HIGH issues
- ✅ Deploy verification for CF stories → cfn-lint passed on all templates
- ✅ Emergent items → backlog → B-21 and B-22 created

## Technical Debt

| Item | Description | Priority |
|------|-------------|----------|
| B-21 | Split shared LambdaExecutionRole into per-function roles | Medium |
| B-22 | Add max retry limit to aws_ec2_route53.py recursion | Medium |

## Action Items

1. Pre-check pattern: `grep -r` for resource references before any CF modification
2. Prioritize B-21 (shared role split) — each code review adds more missing permissions
3. When story scope expands beyond original ACs, document the pivot in Dev Notes
